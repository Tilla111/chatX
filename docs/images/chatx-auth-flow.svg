<svg width="1500" height="760" viewBox="0 0 1500 760" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="title desc">
  <title id="title">ChatX auth flow</title>
  <desc id="desc">Ro'yxatdan o'tish, activation va login oqimi</desc>
  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#334155"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="7" stdDeviation="9" flood-color="#0F172A" flood-opacity="0.15"/>
    </filter>
  </defs>

  <rect width="1500" height="760" fill="#F8FAFC"/>
  <text x="52" y="68" font-family="Segoe UI, Arial, sans-serif" font-size="36" font-weight="700" fill="#0F172A">ChatX Authentication Flow</text>
  <text x="52" y="106" font-family="Segoe UI, Arial, sans-serif" font-size="20" fill="#334155">Register -> Email Activation -> Login -> JWT</text>

  <g filter="url(#shadow)">
    <rect x="74" y="202" width="230" height="142" rx="16" ry="16" fill="#E0F2FE" stroke="#0EA5E9"/>
    <text x="189" y="250" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="22" font-weight="700" fill="#0C4A6E">1. Register</text>
    <text x="189" y="286" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="16" fill="#075985">POST /users/authentication</text>
    <text x="189" y="312" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="16" fill="#075985">username,email,password</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="358" y="202" width="278" height="142" rx="16" ry="16" fill="#ECFEFF" stroke="#06B6D4"/>
    <text x="497" y="250" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="22" font-weight="700" fill="#164E63">2. Create Activation</text>
    <text x="497" y="286" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="16" fill="#0E7490">SHA256 token hash</text>
    <text x="497" y="312" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="16" fill="#0E7490">user_invitations(expiry)</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="690" y="202" width="254" height="142" rx="16" ry="16" fill="#FEF3C7" stroke="#F59E0B"/>
    <text x="817" y="250" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="22" font-weight="700" fill="#78350F">3. Send Email</text>
    <text x="817" y="286" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="16" fill="#92400E">Mailtrap SMTP</text>
    <text x="817" y="312" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="16" fill="#92400E">/users/activate/{token}</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="996" y="202" width="230" height="142" rx="16" ry="16" fill="#DCFCE7" stroke="#22C55E"/>
    <text x="1111" y="250" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="22" font-weight="700" fill="#14532D">4. Activate</text>
    <text x="1111" y="286" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="16" fill="#166534">GET/PUT activate token</text>
    <text x="1111" y="312" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="16" fill="#166534">users.is_active = true</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="1276" y="202" width="170" height="142" rx="16" ry="16" fill="#DBEAFE" stroke="#3B82F6"/>
    <text x="1361" y="250" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="22" font-weight="700" fill="#1E3A8A">5. Login</text>
    <text x="1361" y="286" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="14" fill="#1D4ED8">POST /users/authentication/token</text>
    <text x="1361" y="312" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="16" fill="#1D4ED8">JWT qaytadi</text>
  </g>

  <g stroke="#334155" stroke-width="3" fill="none" marker-end="url(#arrow)">
    <path d="M304 273 L358 273"/>
    <path d="M636 273 L690 273"/>
    <path d="M944 273 L996 273"/>
    <path d="M1226 273 L1276 273"/>
  </g>

  <g filter="url(#shadow)">
    <rect x="120" y="446" width="1260" height="232" rx="18" ry="18" fill="#FFFFFF" stroke="#CBD5E1"/>
    <text x="152" y="494" font-family="Segoe UI, Arial, sans-serif" font-size="26" font-weight="700" fill="#0F172A">Muhim qoidalar</text>
    <text x="152" y="538" font-family="Segoe UI, Arial, sans-serif" font-size="21" fill="#334155">- Login faqat aktivatsiyadan keyin ishlaydi (`users.is_active=true`).</text>
    <text x="152" y="574" font-family="Segoe UI, Arial, sans-serif" font-size="21" fill="#334155">- JWT claimlar: `sub`, `username`, `aud`, `iss`, `exp`, `iat`, `nbf`.</text>
    <text x="152" y="610" font-family="Segoe UI, Arial, sans-serif" font-size="21" fill="#334155">- Protected endpointlar `Authorization: Bearer &lt;token&gt;` talab qiladi.</text>
    <text x="152" y="646" font-family="Segoe UI, Arial, sans-serif" font-size="21" fill="#334155">- WebSocket uchun query fallback bor: `/api/v1/ws?token=&lt;jwt&gt;`.</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="980" y="62" width="440" height="92" rx="14" ry="14" fill="#FEE2E2" stroke="#F87171"/>
    <text x="1200" y="98" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="20" font-weight="700" fill="#991B1B">
      Inactive user login qilolmaydi
    </text>
    <text x="1200" y="128" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="16" fill="#B91C1C">
      Avval activation linkni ishlatish kerak
    </text>
  </g>
</svg>
